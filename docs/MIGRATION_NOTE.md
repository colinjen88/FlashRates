# ğŸ³ Docker é·ç§»èªªæ˜ (Generated by AI)

æ­¤å°ˆæ¡ˆå·²æ–¼ **2026-01-19** å¾å‚³çµ± Nginx æ¶æ§‹é·ç§»è‡³ Docker å®¹å™¨åŒ–æ¶æ§‹ã€‚

## ğŸ“ å°ˆæ¡ˆè³‡è¨Š
- **ç¶²åŸŸ**: `goldlab.cloud` / `www.goldlab.cloud`
- **è·¯å¾‘**: `/home/docker-server/projects/flashrates`
- **åŸå§‹è·¯å¾‘å‚™ä»½**: `/var/www/flashrates` (èˆŠæª”æ¡ˆä»ä¿ç•™ä½†æœªé‹ä½œ)

## ğŸ—ï¸ æ¶æ§‹èªªæ˜
ç³»çµ±ç”±å…©å€‹ Docker å®¹å™¨çµ„æˆï¼š
1. **frontend** (`nginx:alpine`): è² è²¬æä¾›éœæ…‹ HTML/JS/CSSï¼Œä¸¦ä½œç‚ºåå‘ä»£ç†è½‰ç™¼ API è«‹æ±‚ã€‚
2. **backend** (`python:3.11-slim`): é‹è¡Œ FastAPI æ‡‰ç”¨èˆ‡ WebSocket æœå‹™ã€‚

```bash
[Internet] -> [nginx-proxy (Gateway)] -> [frontend (Nginx)] -> [backend (FastAPI)]
```

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤

### å•Ÿå‹•/åœæ­¢
```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™ (èƒŒæ™¯åŸ·è¡Œ)
docker-compose up -d

# åœæ­¢æœå‹™
docker-compose down

# é‡å•Ÿæœå‹™
docker-compose restart
```

### æŸ¥çœ‹ç‹€æ…‹èˆ‡æ—¥èªŒ
```bash
# æŸ¥çœ‹å®¹å™¨ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹å³æ™‚æ—¥èªŒ (åŒ…å«å‰ç«¯èˆ‡å¾Œç«¯)
docker-compose logs -f

# åªçœ‹å¾Œç«¯æ—¥èªŒ
docker-compose logs -f backend
```

## ğŸ”„ å¦‚ä½•æ›´æ–°ç¨‹å¼ç¢¼ï¼Ÿ

### æ›´æ–°å‰ç«¯
1. å°‡æ–°çš„ `dist` æª”æ¡ˆä¸Šå‚³ä¸¦è¦†è“‹ `frontend_dist/` ç›®éŒ„ã€‚
2. **é‡è¦**ï¼šè«‹ç¢ºä¿æ–°ç·¨è­¯çš„ JS æª”æ¡ˆä¸­ï¼ŒWebSocket é€£ç·šæŒ‡å‘ `wss://goldlab.cloud/ws/stream` è€Œé localhostã€‚
   - å¯ç”¨æŒ‡ä»¤ä¿®æ­£ï¼š`sed -i 's|localhost:8000|goldlab.cloud|g' frontend_dist/assets/*.js`

### æ›´æ–°å¾Œç«¯
1. ä¿®æ”¹ `backend/` ç›®éŒ„ä¸‹çš„ Python ç¨‹å¼ç¢¼ã€‚
2. é‡å»ºå®¹å™¨ä»¥å¥—ç”¨è®Šæ›´ï¼š
   ```bash
   docker-compose up -d --build backend
   ```

## âš ï¸ é·ç§»æ™‚çš„ç‰¹æ®Šä¿®æ”¹
ç‚ºäº†è®“èˆŠç¨‹å¼ç¢¼åœ¨ Docker ç’°å¢ƒæ­£å¸¸é‹ä½œï¼Œé·ç§»éç¨‹ä¸­åŸ·è¡Œäº†ä»¥ä¸‹è‡ªå‹•åŒ–ä¿®æ”¹ï¼š
1. **Hardcoded URL Fix**: å‰ç«¯ JS ä¸­çš„ `ws://localhost:8000` å·²æ‰¹é‡æ›¿æ›ç‚º `wss://goldlab.cloud`ã€‚
2. **API Key Removal**: ç§»é™¤äº†å‰ç«¯é€£ç·šå­—ä¸²ä¸­ç„¡æ•ˆçš„ `?api_key=YOUR_API_KEY` åƒæ•¸ï¼Œä»¥ä¿®å¾© WebSocket é€£ç·šå¤±æ•—å•é¡Œã€‚
